enum GandalfErrorCode {
    InvalidSignature    = 'INVALID_SIGNATURE',
    InvalidService      = 'PROTOCOL_NOT_SUPPORTED',
    RecordNotFound      = 'RECORD_NOT_FOUND',
    InternalServerError = 'INTERNAL_SERVER_ERROR'
  }
    
class GandalfError extends Error {
    code: GandalfErrorCode
    constructor(message: string, code: GandalfErrorCode) {
        super(message);

        Object.setPrototypeOf(this, GandalfError.prototype);
        this.name = this.constructor.name;
        this.code = code;
    }
}

function handleErrors(error: any) {
    if (error.response?.errors) {
        switch (error.response.errors[0].extensions.code) {
            case "INVALID_SIGNATURE":
                throw new GandalfError(
                    error.response.errors[0].message + ' verify your private key', 
                    GandalfErrorCode.InvalidSignature,
                ) 
            case "RECORD_NOT_FOUND":
                throw new GandalfError(
                    error.response.errors[0].message, 
                    GandalfErrorCode.RecordNotFound,
                ) 
            case "PROTOCOL_NOT_SUPPORTED":
                throw new GandalfError(
                    error.response.errors[0].message, 
                    GandalfErrorCode.InvalidService,
                ) 
            default:
                throw new GandalfError(
                    error.response.errors[0].message, 
                    GandalfErrorCode.InternalServerError,
                ) 
        }
    } else throw new GandalfError(
        error.message, 
        GandalfErrorCode.InternalServerError,
    ) 
}
    
export { GandalfError, GandalfErrorCode, handleErrors };